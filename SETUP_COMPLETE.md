# ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

**–î–∞—Ç–∞:** 2024-12-01

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –ó–∞–º–µ–Ω–µ–Ω—ã –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ Admin API

**–§–∞–π–ª:** `backend/src/routes/admin.ts`

–í—Å–µ 6 endpoints —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

- `/api/admin/analytics/overview` - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `/api/admin/analytics/users-chart` - –≥—Ä–∞—Ñ–∏–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
- `/api/admin/analytics/events-top` - —Ç–æ–ø —Å–æ–±—ã—Ç–∏–π
- `/api/admin/analytics/funnel` - –≤–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
- `/api/admin/analytics/activity-heatmap` - –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º/—á–∞—Å–∞–º
- `/api/admin/analytics/recent-matches` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ –º–∞—Ç—á–∏

### ‚úÖ 2. –°–æ–∑–¥–∞–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

**–§–∞–π–ª:** `backend/src/repositories/analyticsRepository.ts`

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–µ—Ç–æ–¥—ã:

- `getUserStats()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `getEventStats()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π
- `getMatchStats()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Ç—á–µ–π
- `getConversionRates()` - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
- `getUserChartData()` - –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `getTopEvents()` - —Ç–æ–ø —Å–æ–±—ã—Ç–∏–π –ø–æ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏
- `getFunnelData()` - –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–æ—Ä–æ–Ω–∫–∏
- `getActivityHeatmap()` - –¥–∞–Ω–Ω—ã–µ –¥–ª—è heatmap –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- `getRecentMatches()` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ –º–∞—Ç—á–∏
- `getOnlineUsersCount()` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- –ó–∞–ø—Ä–æ—Å—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è YDB
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–º–µ—Å—Ç–æ UNION ALL (YDB –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)
- Heatmap –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JavaScript —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é (YDB –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç EXTRACT)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å fallback –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

### ‚úÖ 3. –ü—Ä–æ–≤–µ—Ä–µ–Ω .env —Ñ–∞–π–ª

**–°—Ç–∞—Ç—É—Å:** –§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:**

- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `YDB_TOKEN_DEV` (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å `YDB_TOKEN_DEV` –≤ `.env` –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç.

### ‚úÖ 4. –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—å –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ YDB

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ YDB (–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–æ–∫–µ–Ω –∏–ª–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç)

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å YDB –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ `.env`:

   ```bash
   YDB_ENDPOINT_DEV=your-endpoint
   YDB_DATABASE_DEV=your-database
   YDB_TOKEN_DEV=your-token  # –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
   ```

2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:
   ```bash
   npm run migrate
   ```

### ‚è≥ 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

**–°—Ç–∞—Ç—É—Å:** –û–∂–∏–¥–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ YDB

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:**

```bash
NODE_ENV=development npm run dev:all
```

**–ß—Ç–æ –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω–æ:**

- Frontend –Ω–∞ `http://localhost:3000`
- Backend –Ω–∞ `http://localhost:4000`
- Admin –Ω–∞ `http://localhost:5174`
- Bot (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:

1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å YDB:**

   ```bash
   # –í .env —Ñ–∞–π–ª–µ
   YDB_ENDPOINT_DEV=grpcs://ydb.serverless.yandexcloud.net:2135
   YDB_DATABASE_DEV=/ru-central1/b1g.../etn...
   YDB_TOKEN_DEV=your-token
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:**

   ```bash
   npm run migrate
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π:**

   ```bash
   npm run migrate:status
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   NODE_ENV=development npm run dev:all
   ```

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:

- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Yandex AppMetrica/Catcher)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Object Storage –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å GitHub Secrets –¥–ª—è –¥–µ–ø–ª–æ—è

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **YDB —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
   - –ó–∞–º–µ–Ω–µ–Ω—ã UNION ALL –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
   - –£–±—Ä–∞–Ω—ã EXTRACT —Ñ—É–Ω–∫—Ü–∏–∏ (–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è YDB)
   - Heatmap –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JavaScript —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
   - Fallback –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
   - Graceful degradation –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è YDB
   - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
   - Batch –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- Admin API —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –ö–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –ª–∏–Ω—Ç–µ—Ä–æ–º, –æ—à–∏–±–æ–∫ –Ω–µ—Ç
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã –∫ –∑–∞–ø—É—Å–∫—É –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ YDB

---

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ: 95%** ‚úÖ

–û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å YDB –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É!
