# –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è YDB

## ‚úÖ –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ)

- **YDB_ENDPOINT**: `grpcs://ydb.serverless.yandexcloud.net:2135/?database=/ru-central1/b1g6a1tnrohoeas9v0k6/etnbi9hemleeobirfbrv`
- **YDB_DATABASE**: `/ru-central1/b1g6a1tnrohoeas9v0k6/etnbi9hemleeobirfbrv`
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**: `dating-app-db-prod` (ID: `etnbi9hemleeobirfbrv`)

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: "Database not found"

–°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ **–ø—Ä–∞–≤–∞—Ö Service Account**.

## üîß –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ Service Account

### –®–∞–≥ 1: –ù–∞–π–¥–∏—Ç–µ Service Account

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Yandex Cloud Console](https://console.cloud.yandex.ru/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Service Accounts**
3. –ù–∞–π–¥–∏—Ç–µ service account, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:
   - –ò–º—è: `lug-date-service-account`
   - ID: `ajealt724899jtugjv6k` (–∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `YC_SERVICE_ACCOUNT_ID`)

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ–ª–∏ –Ω–∞ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

1. –û—Ç–∫—Ä–æ–π—Ç–µ service account `lug-date-service-account`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **–†–æ–ª–∏**
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ —Ä–æ–ª—å –Ω–∞ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö YDB:
   - –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–æ–ª—å **YDB Editor** –∏–ª–∏ **YDB Admin** –Ω–∞ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö `dating-app-db-prod`
   - –ò–ª–∏ –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥–µ `b1g6a1tnrohoeas9v0k6`

### –®–∞–≥ 3: –ï—Å–ª–∏ —Ä–æ–ª–∏ –Ω–µ—Ç ‚Äî –Ω–∞–∑–Ω–∞—á—å—Ç–µ

1. –ù–∞–∂–º–∏—Ç–µ **–ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª–∏**
2. –í—ã–±–µ—Ä–∏—Ç–µ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö YDB** ‚Üí `dating-app-db-prod`
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å: **YDB Editor** (–∏–ª–∏ **YDB Admin**)
4. –ù–∞–∂–º–∏—Ç–µ **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å**

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –ù–∞–∑–Ω–∞—á—å—Ç–µ —Ä–æ–ª—å –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥:

1. –í—ã–±–µ—Ä–∏—Ç–µ **–ö–∞—Ç–∞–ª–æ–≥** ‚Üí `b1g6a1tnrohoeas9v0k6`
2. –†–æ–ª—å: **YDB Editor**
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Service Account Key

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `YC_SERVICE_ACCOUNT_KEY_B64`
2. –≠—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å base64-encoded JSON –∫–ª—é—á service account
3. –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º (–Ω–µ –∏—Å—Ç–µ–∫)

**–ï—Å–ª–∏ –∫–ª—é—á –∏—Å—Ç–µ–∫:**

1. Service Accounts ‚Üí `lug-date-service-account`
2. –í–∫–ª–∞–¥–∫–∞ **–ö–ª—é—á–∏**
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ JSON –∫–ª—é—á
5. –ó–∞–∫–æ–¥–∏—Ä—É–π—Ç–µ –≤ base64:
   ```bash
   echo -n '{"id":"...","service_account_id":"...","private_key":"..."}' | base64 -w 0
   ```
6. –û–±–Ω–æ–≤–∏—Ç–µ `YC_SERVICE_ACCOUNT_KEY_B64` –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–æ–ª–µ–π:

1. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã (—Ä–æ–ª–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health check:
   ```bash
   curl https://bba2from3lh3r2baegq5.containers.yandexcloud.net/health
   ```
3. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   ```json
   {
     "status": "ok",
     "service": "backend",
     "database": "connected"
   }
   ```

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–æ–ª–µ–π –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫:
   - `ydb_connection_failed`
   - `ydb_driver_ready_failed`
   - `Database not found`

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ service account key –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:
   - –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `ydb_credentials_loaded`
   - –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `ydb_credentials_env_failed`

3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
   - –í –∫–æ–Ω—Å–æ–ª–∏ Yandex Cloud ‚Üí Serverless Containers ‚Üí `lug-date-backend`
   - –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Ä–µ–≤–∏–∑–∏—é (–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–∂–¥–∏—Ç–µ, –ø–æ–∫–∞ —Å—Ç–∞—Ä–∞—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è)

## ‚úÖ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

1. –ú–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ
2. –¢–∞–±–ª–∏—Ü—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. –í—ã —Å–º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É
