# Исправление проблемы с деплоем бекенда

## Проблема

При деплое бекенда через GitHub Actions возникала ошибка:
```
/home/runner/work/_temp/.../sh: line 46: ajejjmpvqbgb79s58mtt: No such file or directory
Error: Process completed with exit code 1.
```

## Причина

Проблема была в том, что значения переменных окружения (особенно секреты) не были правильно экранированы при добавлении в `ENV_STRING`. Когда bash пытался обработать значения, содержащие специальные символы или многострочный JSON (например, `YC_SERVICE_ACCOUNT_KEY`), он интерпретировал их как команды.

## Решение

Исправлен workflow файл `.github/workflows/deploy-backend.yml`:

1. **Передача секретов через секцию `env`**: Все секреты теперь передаются через секцию `env` GitHub Actions, что обеспечивает их безопасное экранирование.

2. **Упрощенная функция `add_env_var`**: Функция теперь просто добавляет переменные в `ENV_STRING`, полагаясь на то, что GitHub Actions уже правильно экранировал значения.

3. **Base64 кодирование для JSON**: Для `YC_SERVICE_ACCOUNT_KEY` (который содержит JSON) используется base64 кодирование, чтобы избежать проблем с специальными символами.

## Изменения

### До:
```yaml
YDB_ENDPOINT="${{ secrets.YDB_ENDPOINT_PROD }}"
if [ -n "$YDB_ENDPOINT" ]; then
  ENV_STRING="${ENV_STRING},YDB_ENDPOINT=${YDB_ENDPOINT}"
fi
```

### После:
```yaml
env:
  YDB_ENDPOINT_VAL: ${{ secrets.YDB_ENDPOINT_PROD }}
run: |
  add_env_var "YDB_ENDPOINT" "$YDB_ENDPOINT_VAL"
```

## Проверка

После исправления:

1. Запустите workflow вручную или сделайте commit и push
2. Проверьте, что деплой проходит успешно
3. Убедитесь, что все переменные окружения правильно установлены в функции

## Дополнительные замечания

- Если значения секретов содержат запятые, это может вызвать проблемы, так как Yandex Cloud Functions использует запятую как разделитель в формате `KEY1=value1,KEY2=value2`
- Для JSON значений (например, `YC_SERVICE_ACCOUNT_KEY`) используется base64 кодирование, чтобы избежать проблем
- Все значения проверяются на `null` и пустоту перед добавлением в `ENV_STRING`

## Следующие шаги

1. Запустите деплой через GitHub Actions
2. Проверьте логи деплоя на наличие ошибок
3. Убедитесь, что функция работает корректно после деплоя

